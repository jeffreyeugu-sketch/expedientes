{% extends 'mi_app/base.html' %}
{% load static %}

{% block nav_dashboard %}active{% endblock %}

{% block page_title %}Dashboard{% endblock %}
{% block page_subtitle %}Panel principal del sistema médico{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'mi_app/css/dashboard.css' %}">
{% endblock %}

{% block content %}
<!-- Estadísticas principales -->
<div class="row mb-4">
    <div class="col-lg-3 col-md-6 mb-4">
        <div class="stats-card stats-primary">
            <div class="stats-icon">
                <i class="fas fa-users"></i>
            </div>
            <div class="stats-content">
                <div class="stats-number">{{ total_pacientes }}</div>
                <div class="stats-label">Total Pacientes</div>
                <div class="stats-trend">
                    <i class="fas fa-arrow-up text-success"></i>
                    <span class="text-success">+12% este mes</span>
                </div>
            </div>
        </div>
    </div>

    <div class="col-lg-3 col-md-6 mb-4">
        <div class="stats-card stats-success">
            <div class="stats-icon">
                <i class="fas fa-calendar-day"></i>
            </div>
            <div class="stats-content">
                <div class="stats-number">{{ consultas_hoy }}</div>
                <div class="stats-label">Consultas Hoy</div>
                <div class="stats-trend">
                    <i class="fas fa-clock text-info"></i>
                    <span class="text-muted">5 pendientes</span>
                </div>
            </div>
        </div>
    </div>

    <div class="col-lg-3 col-md-6 mb-4">
        <div class="stats-card stats-info">
            <div class="stats-icon">
                <i class="fas fa-calendar-week"></i>
            </div>
            <div class="stats-content">
                <div class="stats-number">{{ consultas_semana }}</div>
                <div class="stats-label">Consultas Semana</div>
                <div class="stats-trend">
                    <i class="fas fa-arrow-down text-warning"></i>
                    <span class="text-warning">-3% vs anterior</span>
                </div>
            </div>
        </div>
    </div>

    <div class="col-lg-3 col-md-6 mb-4">
        <div class="stats-card stats-warning">
            <div class="stats-icon">
                <i class="fas fa-user-plus"></i>
            </div>
            <div class="stats-content">
                <div class="stats-number">{{ pacientes_nuevos }}</div>
                <div class="stats-label">Nuevos Este Mes</div>
                <div class="stats-trend">
                    <i class="fas fa-arrow-up text-success"></i>
                    <span class="text-success">+8% vs anterior</span>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Acciones rápidas -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card quick-actions-card">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="fas fa-bolt me-2"></i>Acciones Rápidas
                </h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-3 col-6 mb-3">
                        <a href="{% url 'nuevo_paciente' %}" class="quick-action-btn">
                            <div class="quick-action-icon bg-primary">
                                <i class="fas fa-user-plus"></i>
                            </div>
                            <div class="quick-action-text">
                                <strong>Nuevo Paciente</strong>
                                <small>Registrar paciente</small>
                            </div>
                        </a>
                    </div>

                    <div class="col-md-3 col-6 mb-3">
                        <a href="#" class="quick-action-btn" onclick="MedApp.showNewConsultModal()">
                            <div class="quick-action-icon bg-success">
                                <i class="fas fa-stethoscope"></i>
                            </div>
                            <div class="quick-action-text">
                                <strong>Nueva Consulta</strong>
                                <small>Registrar visita</small>
                            </div>
                        </a>
                    </div>

                    <div class="col-md-3 col-6 mb-3">
                        <a href="{% url 'lista_pacientes' %}" class="quick-action-btn">
                            <div class="quick-action-icon bg-info">
                                <i class="fas fa-search"></i>
                            </div>
                            <div class="quick-action-text">
                                <strong>Buscar Paciente</strong>
                                <small>Ver expedientes</small>
                            </div>
                        </a>
                    </div>

                    <div class="col-md-3 col-6 mb-3">
                        <a href="#" class="quick-action-btn">
                            <div class="quick-action-icon bg-warning">
                                <i class="fas fa-calendar-alt"></i>
                            </div>
                            <div class="quick-action-text">
                                <strong>Ver Agenda</strong>
                                <small>Citas programadas</small>
                            </div>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Sección principal: Citas de hoy y actividad reciente -->
<div class="row">
    <!-- Citas de hoy -->
    <div class="col-lg-8 mb-4">
        <div class="card appointments-card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0">
                    <i class="fas fa-calendar-day me-2"></i>Citas de Hoy
                </h5>
                <span class="badge bg-primary">{{ consultas_hoy }} citas</span>
            </div>
            <div class="card-body p-0">
                <div class="appointments-list">
                    <div class="appointment-item">
                        <div class="appointment-time">
                            <div class="time">10:00</div>
                            <div class="duration">30 min</div>
                        </div>
                        <div class="appointment-info">
                            <div class="patient-name">Juan Carlos Pérez</div>
                            <div class="appointment-type">
                                <i class="fas fa-user-md me-1"></i>Consulta General
                            </div>
                        </div>
                        <div class="appointment-status">
                            <span class="badge bg-success">Confirmada</span>
                        </div>
                        <div class="appointment-actions">
                            <button class="btn btn-sm btn-outline-primary" title="Ver expediente">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn btn-sm btn-outline-success" title="Iniciar consulta">
                                <i class="fas fa-play"></i>
                            </button>
                        </div>
                    </div>

                    <div class="appointment-item">
                        <div class="appointment-time">
                            <div class="time">11:30</div>
                            <div class="duration">45 min</div>
                        </div>
                        <div class="appointment-info">
                            <div class="patient-name">María González López</div>
                            <div class="appointment-type">
                                <i class="fas fa-heartbeat me-1"></i>Seguimiento Cardiológico
                            </div>
                        </div>
                        <div class="appointment-status">
                            <span class="badge bg-warning">En Espera</span>
                        </div>
                        <div class="appointment-actions">
                            <button class="btn btn-sm btn-outline-primary" title="Ver expediente">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn btn-sm btn-outline-success" title="Iniciar consulta">
                                <i class="fas fa-play"></i>
                            </button>
                        </div>
                    </div>

                    <div class="appointment-item">
                        <div class="appointment-time">
                            <div class="time">14:00</div>
                            <div class="duration">30 min</div>
                        </div>
                        <div class="appointment-info">
                            <div class="patient-name">Carlos Roberto Díaz</div>
                            <div class="appointment-type">
                                <i class="fas fa-pills me-1"></i>Control Medicamentos
                            </div>
                        </div>
                        <div class="appointment-status">
                            <span class="badge bg-info">Programada</span>
                        </div>
                        <div class="appointment-actions">
                            <button class="btn btn-sm btn-outline-primary" title="Ver expediente">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn btn-sm btn-outline-success" title="Iniciar consulta">
                                <i class="fas fa-play"></i>
                            </button>
                        </div>
                    </div>

                    <div class="appointment-item">
                        <div class="appointment-time">
                            <div class="time">15:30</div>
                            <div class="duration">60 min</div>
                        </div>
                        <div class="appointment-info">
                            <div class="patient-name">Ana Patricia Morales</div>
                            <div class="appointment-type">
                                <i class="fas fa-user-plus me-1"></i>Primera Consulta
                            </div>
                        </div>
                        <div class="appointment-status">
                            <span class="badge bg-secondary">Nueva Paciente</span>
                        </div>
                        <div class="appointment-actions">
                            <button class="btn btn-sm btn-outline-primary" title="Ver expediente">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn btn-sm btn-outline-success" title="Iniciar consulta">
                                <i class="fas fa-play"></i>
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="card-footer text-center">
                    <a href="#" class="btn btn-sm btn-outline-primary">
                        Ver todas las citas <i class="fas fa-arrow-right ms-1"></i>
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Actividad reciente y alertas -->
    <div class="col-lg-4">
        <!-- Alertas importantes -->
        <div class="card alerts-card mb-4">
            <div class="card-header">
                <h6 class="mb-0">
                    <i class="fas fa-exclamation-triangle me-2"></i>Alertas Importantes
                </h6>
            </div>
            <div class="card-body p-0">
                <div class="alert-item alert-urgent">
                    <div class="alert-icon">
                        <i class="fas fa-exclamation-circle"></i>
                    </div>
                    <div class="alert-content">
                        <div class="alert-title">Cita Urgente</div>
                        <div class="alert-message">María G. requiere atención inmediata</div>
                        <div class="alert-time">Hace 5 minutos</div>
                    </div>
                </div>

                <div class="alert-item alert-reminder">
                    <div class="alert-icon">
                        <i class="fas fa-bell"></i>
                    </div>
                    <div class="alert-content">
                        <div class="alert-title">Recordatorio</div>
                        <div class="alert-message">Renovar receta de Juan P.</div>
                        <div class="alert-time">Hace 2 horas</div>
                    </div>
                </div>

                <div class="alert-item alert-info">
                    <div class="alert-icon">
                        <i class="fas fa-info-circle"></i>
                    </div>
                    <div class="alert-content">
                        <div class="alert-title">Resultado de Laboratorio</div>
                        <div class="alert-message">Análisis de Carlos D. listos</div>
                        <div class="alert-time">Hace 1 día</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Actividad reciente -->
        <div class="card activity-card">
            <div class="card-header">
                <h6 class="mb-0">
                    <i class="fas fa-history me-2"></i>Actividad Reciente
                </h6>
            </div>
            <div class="card-body p-0">
                <div class="activity-list">
                    <div class="activity-item">
                        <div class="activity-icon bg-success">
                            <i class="fas fa-user-plus"></i>
                        </div>
                        <div class="activity-content">
                            <div class="activity-title">Nuevo paciente registrado</div>
                            <div class="activity-detail">Ana Patricia Morales</div>
                            <div class="activity-time">Hace 30 minutos</div>
                        </div>
                    </div>

                    <div class="activity-item">
                        <div class="activity-icon bg-primary">
                            <i class="fas fa-stethoscope"></i>
                        </div>
                        <div class="activity-content">
                            <div class="activity-title">Consulta completada</div>
                            <div class="activity-detail">Juan Carlos Pérez</div>
                            <div class="activity-time">Hace 1 hora</div>
                        </div>
                    </div>

                    <div class="activity-item">
                        <div class="activity-icon bg-info">
                            <i class="fas fa-file-medical-alt"></i>
                        </div>
                        <div class="activity-content">
                            <div class="activity-title">Expediente actualizado</div>
                            <div class="activity-detail">María González López</div>
                            <div class="activity-time">Hace 2 horas</div>
                        </div>
                    </div>

                    <div class="activity-item">
                        <div class="activity-icon bg-warning">
                            <i class="fas fa-pills"></i>
                        </div>
                        <div class="activity-content">
                            <div class="activity-title">Receta generada</div>
                            <div class="activity-detail">Carlos Roberto Díaz</div>
                            <div class="activity-time">Hace 3 horas</div>
                        </div>
                    </div>
                </div>

                <div class="card-footer text-center">
                    <a href="#" class="btn btn-sm btn-outline-secondary">
                        Ver todo el historial <i class="fas fa-arrow-right ms-1"></i>
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal para nueva consulta rápida -->
<div class="modal fade" id="newConsultModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="fas fa-stethoscope me-2"></i>Nueva Consulta Rápida
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form>
                    <div class="row">
                        <div class="col-md-6">
                            <label class="form-label">Buscar Paciente</label>
                            <input type="text" class="form-control" placeholder="Nombre del paciente...">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Tipo de Consulta</label>
                            <select class="form-select">
                                <option>Consulta General</option>
                                <option>Seguimiento</option>
                                <option>Urgencia</option>
                                <option>Control</option>
                            </select>
                        </div>
                    </div>
                    <div class="row mt-3">
                        <div class="col-md-6">
                            <label class="form-label">Fecha</label>
                            <input type="date" class="form-control" value="2025-09-25">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Hora</label>
                            <input type="time" class="form-control">
                        </div>
                    </div>
                    <div class="mt-3">
                        <label class="form-label">Motivo de la Consulta</label>
                        <textarea class="form-control" rows="3" placeholder="Describe brevemente el motivo de la consulta..."></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                <button type="button" class="btn btn-primary">
                    <i class="fas fa-save me-2"></i>Programar Consulta
                </button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Funciones específicas del dashboard
window.MedApp = window.MedApp || {};

MedApp.showNewConsultModal = function() {
    const modal = new bootstrap.Modal(document.getElementById('newConsultModal'));
    modal.show();
};

// Animaciones de contadores
document.addEventListener('DOMContentLoaded', function() {
    const counters = document.querySelectorAll('.stats-number');
    counters.forEach(counter => {
        const target = parseInt(counter.textContent);
        counter.textContent = '0';
        
        const increment = target / 50;
        const timer = setInterval(() => {
            const current = parseInt(counter.textContent);
            if (current < target) {
                counter.textContent = Math.ceil(current + increment);
            } else {
                counter.textContent = target;
                clearInterval(timer);
            }
        }, 20);
    });
});
</script>
{% endblock %}